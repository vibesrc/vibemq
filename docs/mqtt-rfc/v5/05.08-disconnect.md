# Section 5.8: DISCONNECT – Disconnect Notification

> - Previous: [Section 5.7: PINGREQ and PINGRESP](./05.07-ping.md)
> - Next: [Section 5.9: AUTH](./05.09-auth.md)

---

## 5.8.1 Overview

In MQTT 5.0, the DISCONNECT packet can be sent by **both** Client and Server (Server-initiated DISCONNECT is new in v5.0).

## 5.8.2 Fixed Header

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────┬───────────────┐
byte 1    │  1   1   1   0│  0   0   0   0│  = 0xE0
          └───────────────┴───────────────┘
byte 2+   │       Remaining Length        │
          └───────────────────────────────┘
```

## 5.8.3 Variable Header

1. **Reason Code** (1 byte) - Can be omitted if 0x00 with no properties
2. **Properties**

### 5.8.3.1 DISCONNECT Reason Codes

| Value | Reason Code | Sent By |
|-------|-------------|---------|
| 0x00 | Normal disconnection | Client, Server |
| 0x04 | Disconnect with Will Message | Client |
| 0x80 | Unspecified error | Client, Server |
| 0x81 | Malformed Packet | Client, Server |
| 0x82 | Protocol Error | Client, Server |
| 0x83 | Implementation specific error | Client, Server |
| 0x87 | Not authorized | Server |
| 0x89 | Server busy | Server |
| 0x8B | Server shutting down | Server |
| 0x8C | Bad authentication method | Server |
| 0x8D | Keep Alive timeout | Server |
| 0x8E | Session taken over | Server |
| 0x8F | Topic Filter invalid | Server |
| 0x90 | Topic Name invalid | Client, Server |
| 0x93 | Receive Maximum exceeded | Client, Server |
| 0x94 | Topic Alias invalid | Client, Server |
| 0x95 | Packet too large | Client, Server |
| 0x96 | Message rate too high | Client, Server |
| 0x97 | Quota exceeded | Client, Server |
| 0x98 | Administrative action | Server |
| 0x99 | Payload format invalid | Client, Server |
| 0x9A | Retain not supported | Server |
| 0x9B | QoS not supported | Server |
| 0x9C | Use another server | Server |
| 0x9D | Server moved | Server |
| 0x9E | Shared Subscriptions not supported | Server |
| 0x9F | Connection rate exceeded | Server |
| 0xA0 | Maximum connect time | Server |
| 0xA1 | Subscription Identifiers not supported | Server |
| 0xA2 | Wildcard Subscriptions not supported | Server |

### 5.8.3.2 DISCONNECT Properties

| Property | ID | Type | Description |
|----------|----|----- |-------------|
| Session Expiry Interval | 0x11 | Four Byte Integer | Override session expiry |
| Reason String | 0x1F | UTF-8 String | Human-readable reason |
| User Property | 0x26 | UTF-8 String Pair | Multiple allowed |
| Server Reference | 0x1C | UTF-8 String | Redirect to another server |

**[MQTT-3.14.2-1]** Session Expiry Interval in DISCONNECT MUST NOT be set to non-zero if the Session Expiry Interval in CONNECT was zero.

## 5.8.4 Payload

The DISCONNECT packet has no Payload.

## 5.8.5 Actions

### Client DISCONNECT with Reason Code 0x00:
- Will Message is NOT published
- Session state follows Session Expiry Interval

### Client DISCONNECT with Reason Code 0x04:
- Will Message IS published (after Will Delay Interval)
- Used to notify others that session is ending

### Server DISCONNECT:
- Server sends DISCONNECT before closing connection
- Provides reason for disconnection
- May include Server Reference for redirection

## 5.8.6 Examples

### Normal Client Disconnect (minimal):
```
0xE0 0x00
```

### Client Disconnect with Will Message:
```
0xE0 0x02 0x04 0x00
```
(Reason Code 0x04, Property Length 0)

### Server Disconnect (shutting down):
```
0xE0 0x02 0x8B 0x00
```
(Reason Code 0x8B, Property Length 0)
