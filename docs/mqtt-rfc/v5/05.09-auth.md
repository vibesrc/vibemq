# Section 5.9: AUTH – Authentication Exchange

> - Previous: [Section 5.8: DISCONNECT](./05.08-disconnect.md)
> - Up: [Section 5: Control Packets](./05.01-connect.md)

---

## 5.9.1 Overview

The AUTH packet is **new in MQTT 5.0**. It enables challenge/response authentication flows that require multiple exchanges between Client and Server.

AUTH packets can be sent by both Client and Server after CONNECT but before CONNACK, and also during an active connection for re-authentication.

## 5.9.2 Fixed Header

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────┬───────────────┐
byte 1    │  1   1   1   1│  0   0   0   0│  = 0xF0
          └───────────────┴───────────────┘
byte 2+   │       Remaining Length        │
          └───────────────────────────────┘
```

## 5.9.3 Variable Header

1. **Reason Code** (1 byte)
2. **Properties**

### 5.9.3.1 AUTH Reason Codes

| Value | Reason Code | Sent By | Description |
|-------|-------------|---------|-------------|
| 0x00 | Success | Server | Authentication successful |
| 0x18 | Continue authentication | Both | Continue auth exchange |
| 0x19 | Re-authenticate | Client | Start re-authentication |

### 5.9.3.2 AUTH Properties

| Property | ID | Type | Required |
|----------|----|----- |----------|
| Authentication Method | 0x15 | UTF-8 String | Yes |
| Authentication Data | 0x16 | Binary Data | Depends on method |
| Reason String | 0x1F | UTF-8 String | Optional |
| User Property | 0x26 | UTF-8 String Pair | Optional |

## 5.9.4 Payload

The AUTH packet has no Payload.

## 5.9.5 Authentication Flows

### 5.9.5.1 Simple Challenge/Response

```
Client                              Server
   │                                   │
   │  CONNECT                          │
   │  + Auth Method: "SCRAM-SHA-256"   │
   │  + Auth Data: client-first        │
   │ ──────────────────────────────►  │
   │                                   │
   │  AUTH (Continue)                  │
   │  + Auth Data: server-first        │
   │ ◄──────────────────────────────  │
   │                                   │
   │  AUTH (Continue)                  │
   │  + Auth Data: client-final        │
   │ ──────────────────────────────►  │
   │                                   │
   │  CONNACK (Success)                │
   │  + Auth Data: server-final        │
   │ ◄──────────────────────────────  │
   │                                   │
```

### 5.9.5.2 Re-authentication

```
Client                              Server
   │                                   │
   │  (Already connected)              │
   │                                   │
   │  AUTH (Re-authenticate)           │
   │  + Auth Method: "SCRAM-SHA-256"   │
   │  + Auth Data: client-first        │
   │ ──────────────────────────────►  │
   │                                   │
   │  AUTH (Continue)                  │
   │  + Auth Data: server-first        │
   │ ◄──────────────────────────────  │
   │                                   │
   │  AUTH (Continue)                  │
   │  + Auth Data: client-final        │
   │ ──────────────────────────────►  │
   │                                   │
   │  AUTH (Success)                   │
   │  + Auth Data: server-final        │
   │ ◄──────────────────────────────  │
   │                                   │
```

## 5.9.6 Requirements

**[MQTT-4.12.0-1]** If a Client sets an Authentication Method in CONNECT, the Client MUST NOT send any packets other than AUTH or DISCONNECT until it has received a CONNACK.

**[MQTT-4.12.0-2]** If the Client does not set an Authentication Method in CONNECT, the Server MUST NOT send an AUTH packet, and the Client MUST NOT send an AUTH packet.

**[MQTT-4.12.0-3]** If the Client does not set an Authentication Method in CONNECT, the Server MUST authenticate using only information in CONNECT.

**[MQTT-4.12.1-1]** If the Client supplied an Authentication Method in CONNECT and wants to re-authenticate, it sends AUTH with Reason Code 0x19 (Re-authenticate).

**[MQTT-4.12.1-2]** The Authentication Method in re-authentication MUST be the same as originally used in CONNECT.

## 5.9.7 Example Authentication Methods

| Method | Description |
|--------|-------------|
| SCRAM-SHA-256 | Salted Challenge Response |
| GS2-KRB5 | Kerberos V5 |
| EXTERNAL | Out-of-band (e.g., TLS client cert) |
| PLAIN | Simple username/password (over TLS) |
