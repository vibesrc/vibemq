# Section 4.2: Fixed Header

> This section is part of [Section 4: Control Packet Format](./04.01-packet-structure.md).
> 
> - Previous: [Section 4.1: Packet Structure](./04.01-packet-structure.md)
> - Next: [Section 4.3: Variable Header](./04.03-variable-header.md)

---

## 4.2.1 Fixed Header Format

Each MQTT Control Packet contains a Fixed Header with the following structure:

### Figure 4-2: Fixed Header Format

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────┬───────────────┐
byte 1    │  Packet Type  │    Flags      │
          │   (bits 7-4)  │  (bits 3-0)   │
          └───────────────┴───────────────┘
byte 2+   │       Remaining Length        │
          │  (Variable Byte Integer)      │
          └───────────────────────────────┘
```

## 4.2.2 MQTT Control Packet Type

**Position:** byte 1, bits 7-4

Represented as a 4-bit unsigned value. See [Table 4-1](./04.01-packet-structure.md#table-4-1-control-packet-types) for values.

## 4.2.3 Flags

**Position:** byte 1, bits 3-0

The remaining bits [3-0] of byte 1 contain flags specific to each MQTT Control Packet type.

### Table 4-3: Fixed Header Flag Bits

| Packet | Bit 3 | Bit 2 | Bit 1 | Bit 0 | Description |
|--------|-------|-------|-------|-------|-------------|
| CONNECT | 0 | 0 | 0 | 0 | Reserved |
| CONNACK | 0 | 0 | 0 | 0 | Reserved |
| PUBLISH | DUP | QoS | QoS | RETAIN | See below |
| PUBACK | 0 | 0 | 0 | 0 | Reserved |
| PUBREC | 0 | 0 | 0 | 0 | Reserved |
| PUBREL | 0 | 0 | 1 | 0 | Reserved |
| PUBCOMP | 0 | 0 | 0 | 0 | Reserved |
| SUBSCRIBE | 0 | 0 | 1 | 0 | Reserved |
| SUBACK | 0 | 0 | 0 | 0 | Reserved |
| UNSUBSCRIBE | 0 | 0 | 1 | 0 | Reserved |
| UNSUBACK | 0 | 0 | 0 | 0 | Reserved |
| PINGREQ | 0 | 0 | 0 | 0 | Reserved |
| PINGRESP | 0 | 0 | 0 | 0 | Reserved |
| DISCONNECT | 0 | 0 | 0 | 0 | Reserved |
| AUTH | 0 | 0 | 0 | 0 | Reserved |

**[MQTT-2.1.3-1]** Where a flag bit is marked as "Reserved", it is reserved for future use and MUST be set to the value listed. If invalid flags are received it is a Malformed Packet.

### PUBLISH Flags Detail

| Flag | Bit(s) | Description |
|------|--------|-------------|
| DUP | 3 | Duplicate delivery of PUBLISH |
| QoS | 2-1 | Quality of Service (0, 1, or 2) |
| RETAIN | 0 | Retained message flag |

See [Section 5.3: PUBLISH](./05.03-publish.md) for details.

## 4.2.4 Remaining Length

**Position:** starts at byte 2

The Remaining Length is a Variable Byte Integer that represents the number of bytes remaining within the current Control Packet, including data in the Variable Header and the Payload. The Remaining Length does NOT include the bytes used to encode the Remaining Length itself.

The packet size is the total number of bytes in an MQTT Control Packet, equal to:
```
Packet Size = Fixed Header Length + Remaining Length
```

Where Fixed Header Length is 1 byte (packet type + flags) plus the bytes needed to encode the Remaining Length.

### Table 4-4: Remaining Length Encoding

| Bytes | Minimum Value | Maximum Value |
|-------|---------------|---------------|
| 1 | 0 | 127 |
| 2 | 128 | 16,383 |
| 3 | 16,384 | 2,097,151 |
| 4 | 2,097,152 | 268,435,455 |

> **Note:** The maximum packet size is 268,435,455 bytes (256 MB), but servers and clients may negotiate lower limits via the Maximum Packet Size property.

## 4.2.5 Fixed Header Examples

### Table 4-5: Common Fixed Header Values

| Packet Type | Byte 1 Hex | Description |
|-------------|------------|-------------|
| CONNECT | 0x10 | Type 1, flags 0000 |
| CONNACK | 0x20 | Type 2, flags 0000 |
| PUBLISH QoS 0 | 0x30 | Type 3, DUP=0, QoS=0, RETAIN=0 |
| PUBLISH QoS 0 RETAIN | 0x31 | Type 3, DUP=0, QoS=0, RETAIN=1 |
| PUBLISH QoS 1 | 0x32 | Type 3, DUP=0, QoS=1, RETAIN=0 |
| PUBLISH QoS 1 DUP | 0x3A | Type 3, DUP=1, QoS=1, RETAIN=0 |
| PUBLISH QoS 2 | 0x34 | Type 3, DUP=0, QoS=2, RETAIN=0 |
| PUBACK | 0x40 | Type 4, flags 0000 |
| PUBREC | 0x50 | Type 5, flags 0000 |
| PUBREL | 0x62 | Type 6, flags 0010 |
| PUBCOMP | 0x70 | Type 7, flags 0000 |
| SUBSCRIBE | 0x82 | Type 8, flags 0010 |
| SUBACK | 0x90 | Type 9, flags 0000 |
| UNSUBSCRIBE | 0xA2 | Type 10, flags 0010 |
| UNSUBACK | 0xB0 | Type 11, flags 0000 |
| PINGREQ | 0xC0 | Type 12, flags 0000 |
| PINGRESP | 0xD0 | Type 13, flags 0000 |
| DISCONNECT | 0xE0 | Type 14, flags 0000 |
| AUTH | 0xF0 | Type 15, flags 0000 |
