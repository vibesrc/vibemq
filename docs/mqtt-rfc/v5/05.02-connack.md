# Section 5.2: CONNACK – Connect Acknowledgment

> This section is part of [Section 5: Control Packets](./05.01-connect.md).
> 
> - Previous: [Section 5.1: CONNECT](./05.01-connect.md)
> - Next: [Section 5.3: PUBLISH](./05.03-publish.md)

---

## 5.2.1 Overview

The CONNACK packet is sent by the Server in response to a CONNECT packet received from a Client. The Server MUST send a CONNACK with Reason Code 0x00 (Success) before sending any other packets except AUTH.

## 5.2.2 Fixed Header

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────┬───────────────┐
byte 1    │  0   0   1   0│  0   0   0   0│  = 0x20
          └───────────────┴───────────────┘
byte 2+   │       Remaining Length        │
          └───────────────────────────────┘
```

## 5.2.3 Variable Header

### 5.2.3.1 Connect Acknowledge Flags

```
Bit     7   6   5   4   3   2   1   0
      ┌───────────────────────────┬───┐
      │        Reserved (0)       │ SP│
      └───────────────────────────┴───┘
```

**Session Present (SP):** Bit 0

**[MQTT-3.2.2-1]** If the Server accepts a connection with Clean Start = 1, the Server MUST set Session Present to 0 in the CONNACK.

**[MQTT-3.2.2-2]** If the Server accepts a connection with Clean Start = 0 and has stored Session state, it MUST set Session Present to 1.

**[MQTT-3.2.2-3]** If the Server accepts a connection with Clean Start = 0 and does not have stored Session state, it MUST set Session Present to 0.

### 5.2.3.2 Connect Reason Code

One-byte Reason Code indicating the result of the connection attempt.

### Table 5-1: CONNACK Reason Codes

| Value | Reason Code | Description |
|-------|-------------|-------------|
| 0x00 | Success | Connection accepted |
| 0x80 | Unspecified error | Generic failure |
| 0x81 | Malformed Packet | CONNECT packet could not be parsed |
| 0x82 | Protocol Error | CONNECT packet was valid but protocol rules violated |
| 0x83 | Implementation specific error | Valid packet but rejected |
| 0x84 | Unsupported Protocol Version | Protocol version not supported |
| 0x85 | Client Identifier not valid | Client Identifier rejected |
| 0x86 | Bad User Name or Password | Authentication failed |
| 0x87 | Not authorized | Authorization failed |
| 0x88 | Server unavailable | Server not available |
| 0x89 | Server busy | Server is busy, try later |
| 0x8A | Banned | Client has been banned |
| 0x8C | Bad authentication method | Auth method not supported |
| 0x90 | Topic Name invalid | Will Topic Name malformed |
| 0x95 | Packet too large | CONNECT packet exceeded limit |
| 0x97 | Quota exceeded | Implementation quota exceeded |
| 0x99 | Payload format invalid | Will Payload format invalid |
| 0x9A | Retain not supported | Will Retain = 1 but not supported |
| 0x9B | QoS not supported | Will QoS not supported |
| 0x9C | Use another server | Client should use another server |
| 0x9D | Server moved | Server has moved |
| 0x9F | Connection rate exceeded | Connection rate limit exceeded |

**[MQTT-3.2.2-4]** If a Server sends a CONNACK with a non-zero Reason Code it MUST set Session Present to 0.

**[MQTT-3.2.2-5]** If a Server sends a CONNACK with a non-zero Reason Code it MUST then close the Network Connection.

### 5.2.3.3 CONNACK Properties

| Property | ID | Type | Description |
|----------|----|----- |-------------|
| Session Expiry Interval | 0x11 | Four Byte Integer | Server's session expiry |
| Receive Maximum | 0x21 | Two Byte Integer | Server's receive maximum |
| Maximum QoS | 0x24 | Byte | 0, 1, or 2 |
| Retain Available | 0x25 | Byte | 0 = not supported, 1 = supported |
| Maximum Packet Size | 0x27 | Four Byte Integer | Server's max packet size |
| Assigned Client Identifier | 0x12 | UTF-8 String | Assigned Client ID |
| Topic Alias Maximum | 0x22 | Two Byte Integer | Server's topic alias maximum |
| Reason String | 0x1F | UTF-8 String | Human-readable status |
| User Property | 0x26 | UTF-8 String Pair | Multiple allowed |
| Wildcard Subscription Available | 0x28 | Byte | Default 1 |
| Subscription Identifiers Available | 0x29 | Byte | Default 1 |
| Shared Subscription Available | 0x2A | Byte | Default 1 |
| Server Keep Alive | 0x13 | Two Byte Integer | Override client's keep alive |
| Response Information | 0x1A | UTF-8 String | For request/response |
| Server Reference | 0x1C | UTF-8 String | Redirect to another server |
| Authentication Method | 0x15 | UTF-8 String | For enhanced auth |
| Authentication Data | 0x16 | Binary Data | For enhanced auth |

### 5.2.3.4 Server Capability Discovery

CONNACK properties allow clients to discover server capabilities:

| Property | If Absent |
|----------|-----------|
| Maximum QoS | QoS 2 supported |
| Retain Available | Retained messages supported |
| Maximum Packet Size | No limit beyond protocol max |
| Topic Alias Maximum | Topic aliases not accepted |
| Wildcard Subscription Available | Wildcards supported |
| Subscription Identifiers Available | Subscription IDs supported |
| Shared Subscription Available | Shared subscriptions supported |

## 5.2.4 Payload

The CONNACK packet has no Payload.

## 5.2.5 Examples

### Successful connection with session resumption:

```
Byte 1:    0x20  (CONNACK)
Byte 2:    0x03  (Remaining Length = 3)
Byte 3:    0x01  (Session Present = 1)
Byte 4:    0x00  (Reason Code = Success)
Byte 5:    0x00  (Property Length = 0)
```

### Connection rejected - Bad credentials:

```
Byte 1:    0x20  (CONNACK)
Byte 2:    0x03  (Remaining Length = 3)
Byte 3:    0x00  (Session Present = 0)
Byte 4:    0x86  (Reason Code = Bad User Name or Password)
Byte 5:    0x00  (Property Length = 0)
```
