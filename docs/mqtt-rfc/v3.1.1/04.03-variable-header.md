# Section 4.3: Variable Header

> This section is part of [Section 4: Control Packet Format](./04.01-packet-structure.md).
> 
> - Previous: [Section 4.2: Fixed Header](./04.02-fixed-header.md)
> - Next: [Section 4.4: Payload](./04.04-payload.md)

---

## 4.3.1 Overview

Some types of MQTT Control Packets contain a variable header component. It resides between the fixed header and the payload. The content of the variable header varies depending on the Packet type.

The Packet Identifier field of the variable header is common in several packet types.

## 4.3.2 Packet Identifier

### Figure 4-4: Packet Identifier Format

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────────────────────┐
byte 1    │    Packet Identifier MSB      │
          ├───────────────────────────────┤
byte 2    │    Packet Identifier LSB      │
          └───────────────────────────────┘
```

The variable header component of many Control Packet types includes a 2-byte Packet Identifier field.

### 4.3.2.1 Packets Requiring Packet Identifier

### Table 4-6: Control Packets with Packet Identifier

| Control Packet | Packet Identifier Field |
|----------------|------------------------|
| CONNECT | NO |
| CONNACK | NO |
| PUBLISH | YES (if QoS > 0) |
| PUBACK | YES |
| PUBREC | YES |
| PUBREL | YES |
| PUBCOMP | YES |
| SUBSCRIBE | YES |
| SUBACK | YES |
| UNSUBSCRIBE | YES |
| UNSUBACK | YES |
| PINGREQ | NO |
| PINGRESP | NO |
| DISCONNECT | NO |

### 4.3.2.2 Packet Identifier Requirements

**[MQTT-2.3.1-1]** SUBSCRIBE, UNSUBSCRIBE, and PUBLISH (in cases where QoS > 0) Control Packets MUST contain a non-zero 16-bit Packet Identifier.

**[MQTT-2.3.1-2]** Each time a Client sends a new packet of one of these types it MUST assign it a currently unused Packet Identifier.

**[MQTT-2.3.1-3]** If a Client re-sends a particular Control Packet, then it MUST use the same Packet Identifier in subsequent re-sends of that packet. The Packet Identifier becomes available for reuse after the Client has processed the corresponding acknowledgement packet:
- For QoS 1 PUBLISH: after receiving PUBACK
- For QoS 2 PUBLISH: after receiving PUBCOMP
- For SUBSCRIBE: after receiving SUBACK
- For UNSUBSCRIBE: after receiving UNSUBACK

**[MQTT-2.3.1-4]** The same conditions apply to a Server when it sends a PUBLISH with QoS > 0.

**[MQTT-2.3.1-5]** A PUBLISH Packet MUST NOT contain a Packet Identifier if its QoS value is set to 0.

**[MQTT-2.3.1-6]** A PUBACK, PUBREC, or PUBREL Packet MUST contain the same Packet Identifier as the PUBLISH Packet that was originally sent.

**[MQTT-2.3.1-7]** Similarly SUBACK and UNSUBACK MUST contain the Packet Identifier that was used in the corresponding SUBSCRIBE and UNSUBSCRIBE Packet respectively.

### 4.3.2.3 Packet Identifier Scope

The Client and Server assign Packet Identifiers independently of each other. As a result, Client-Server pairs can participate in concurrent message exchanges using the same Packet Identifiers.

> **Note:** It is possible for a Client to send a PUBLISH Packet with Packet Identifier 0x1234 and then receive a different PUBLISH with Packet Identifier 0x1234 from its Server before it receives a PUBACK for the PUBLISH that it sent.

### Figure 4-5: Concurrent Packet Identifiers

```
    Client                              Server
       │                                   │
       │  PUBLISH (ID=0x1234) ─────────►  │
       │                                   │
       │  ◄───────── PUBLISH (ID=0x1234)  │
       │                                   │
       │  PUBACK (ID=0x1234) ─────────►   │
       │                                   │
       │  ◄───────── PUBACK (ID=0x1234)   │
       │                                   │
```

## 4.3.3 Variable Header Content by Packet Type

### Table 4-7: Variable Header Contents

| Control Packet | Variable Header Contents |
|----------------|-------------------------|
| CONNECT | Protocol Name, Protocol Level, Connect Flags, Keep Alive |
| CONNACK | Connect Acknowledge Flags, Connect Return Code |
| PUBLISH | Topic Name, Packet Identifier (if QoS > 0) |
| PUBACK | Packet Identifier |
| PUBREC | Packet Identifier |
| PUBREL | Packet Identifier |
| PUBCOMP | Packet Identifier |
| SUBSCRIBE | Packet Identifier |
| SUBACK | Packet Identifier |
| UNSUBSCRIBE | Packet Identifier |
| UNSUBACK | Packet Identifier |
| PINGREQ | None |
| PINGRESP | None |
| DISCONNECT | None |

## 4.3.4 Variable Header Size

The variable header size varies by packet type:

| Packet Type | Variable Header Size |
|-------------|---------------------|
| CONNECT | 10 bytes (fixed) |
| CONNACK | 2 bytes |
| PUBLISH | Topic Name length + 2 + (2 if QoS > 0) |
| PUBACK, PUBREC, PUBREL, PUBCOMP | 2 bytes |
| SUBSCRIBE, SUBACK | 2 bytes |
| UNSUBSCRIBE, UNSUBACK | 2 bytes |
| PINGREQ, PINGRESP, DISCONNECT | 0 bytes |
