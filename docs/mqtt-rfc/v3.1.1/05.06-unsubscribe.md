# Section 5.6: UNSUBSCRIBE and UNSUBACK

> This section is part of [Section 5: Control Packets](./05.01-connect.md).
> 
> - Previous: [Section 5.5: SUBSCRIBE and SUBACK](./05.05-subscribe.md)
> - Next: [Section 5.7: PINGREQ and PINGRESP](./05.07-ping.md)

---

## 5.6.1 UNSUBSCRIBE – Unsubscribe from Topics

An UNSUBSCRIBE Packet is sent by the Client to the Server to unsubscribe from topics.

### 5.6.1.1 Fixed Header

### Figure 5-24: UNSUBSCRIBE Packet Fixed Header

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────┬───────────────┐
byte 1    │  1   0   1   0│  0   0   1   0│  = 0xA2
          │  Packet Type  │   Reserved    │
          └───────────────┴───────────────┘
byte 2+   │       Remaining Length        │
          └───────────────────────────────┘
```

**[MQTT-3.10.1-1]** Bits 3,2,1,0 of the fixed header of the UNSUBSCRIBE Control Packet are reserved and MUST be set to 0,0,1,0 respectively. The Server MUST treat any other value as malformed and close the Network Connection.

### 5.6.1.2 Variable Header

The variable header contains a Packet Identifier.

### Figure 5-25: UNSUBSCRIBE Variable Header

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────────────────────┐
byte 1    │    Packet Identifier MSB      │
          ├───────────────────────────────┤
byte 2    │    Packet Identifier LSB      │
          └───────────────────────────────┘
```

### 5.6.1.3 Payload

The payload contains a list of Topic Filters that the Client wishes to unsubscribe from.

**[MQTT-3.10.3-1]** The Topic Filters in an UNSUBSCRIBE packet MUST be UTF-8 encoded strings, packed contiguously.

**[MQTT-3.10.3-2]** The Payload of an UNSUBSCRIBE packet MUST contain at least one Topic Filter. An UNSUBSCRIBE packet with no payload is a protocol violation.

### Figure 5-26: UNSUBSCRIBE Payload Format

```
┌─────────────────────────────────────────────────┐
│     Topic Filter 1 Length MSB                   │
├─────────────────────────────────────────────────┤
│     Topic Filter 1 Length LSB                   │
├─────────────────────────────────────────────────┤
│     Topic Filter 1 (UTF-8 encoded)              │
│     ... (length bytes)                          │
├─────────────────────────────────────────────────┤
│     Topic Filter 2 Length MSB                   │
├─────────────────────────────────────────────────┤
│     Topic Filter 2 Length LSB                   │
├─────────────────────────────────────────────────┤
│     Topic Filter 2 (UTF-8 encoded)              │
│     ... (length bytes)                          │
├─────────────────────────────────────────────────┤
│     ... more Topic Filters                      │
└─────────────────────────────────────────────────┘
```

### 5.6.1.4 Example Payload

Unsubscribing from topics "a/b" and "c/d":

### Table 5-10: UNSUBSCRIBE Payload Example

| Byte | Value | Description |
|------|-------|-------------|
| 1 | 0x00 | Topic Filter 1 Length MSB |
| 2 | 0x03 | Topic Filter 1 Length LSB (3) |
| 3 | 0x61 | 'a' |
| 4 | 0x2F | '/' |
| 5 | 0x62 | 'b' |
| 6 | 0x00 | Topic Filter 2 Length MSB |
| 7 | 0x03 | Topic Filter 2 Length LSB (3) |
| 8 | 0x63 | 'c' |
| 9 | 0x2F | '/' |
| 10 | 0x64 | 'd' |

---

## 5.6.2 UNSUBSCRIBE Response

**[MQTT-3.10.4-1]** The Server MUST respond to an UNSUBSUBSCRIBE request by sending an UNSUBACK packet. The UNSUBACK Packet MUST have the same Packet Identifier as the UNSUBSCRIBE Packet.

**[MQTT-3.10.4-2]** Even if no Topic Filters are matched, the Server MUST respond with an UNSUBACK.

**[MQTT-3.10.4-3]** If a Server receives an UNSUBSCRIBE packet that contains multiple Topic Filters it MUST handle that packet as if it had received a sequence of multiple UNSUBSCRIBE packets, except that it sends just one UNSUBACK response.

**[MQTT-3.10.4-4]** The Topic Filters in an UNSUBSCRIBE packet MUST be compared character-by-character with the current set of Topic Filters held by the Server for the Client. If any filter matches exactly, its owning Subscription is deleted, otherwise no additional processing occurs.

**[MQTT-3.10.4-5]** If a Server deletes a Subscription:
- It MUST stop adding any new messages for delivery to the Client.
- It MUST complete the delivery of any QoS 1 or QoS 2 messages it has started to send to the Client.
- It MAY continue to deliver any existing messages buffered for delivery to the Client.

---

## 5.6.3 UNSUBACK – Unsubscribe Acknowledgement

The UNSUBACK Packet is sent by the Server to the Client to confirm receipt of an UNSUBSCRIBE Packet.

### 5.6.3.1 Fixed Header

### Figure 5-27: UNSUBACK Packet Fixed Header

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────┬───────────────┐
byte 1    │  1   0   1   1│  0   0   0   0│  = 0xB0
          │  Packet Type  │   Reserved    │
          └───────────────┴───────────────┘
byte 2    │  0   0   0   0   0   0   1   0│  = 0x02
          │     Remaining Length (2)      │
          └───────────────────────────────┘
```

### 5.6.3.2 Variable Header

The variable header contains the Packet Identifier of the UNSUBSCRIBE Packet being acknowledged.

### Figure 5-28: UNSUBACK Variable Header

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────────────────────┐
byte 1    │    Packet Identifier MSB      │
          ├───────────────────────────────┤
byte 2    │    Packet Identifier LSB      │
          └───────────────────────────────┘
```

### 5.6.3.3 Payload

The UNSUBACK Packet has no payload.

### 5.6.3.4 Example

```
Byte 1: 0xB0  (UNSUBACK packet type)
Byte 2: 0x02  (Remaining Length = 2)
Byte 3: 0x00  (Packet Identifier MSB)
Byte 4: 0x0A  (Packet Identifier LSB = 10)
```

> **Note:** Unlike SUBACK, UNSUBACK does not contain return codes for each topic filter. In MQTT 3.1.1, there is no way for the Client to know if individual unsubscribe operations succeeded or failed.
