# Section 5.2: CONNACK – Acknowledge Connection Request

> This section is part of [Section 5: Control Packets](./05.01-connect.md).
> 
> - Previous: [Section 5.1: CONNECT](./05.01-connect.md)
> - Next: [Section 5.3: PUBLISH](./05.03-publish.md)

---

## 5.2.1 Overview

The CONNACK Packet is the packet sent by the Server in response to a CONNECT Packet received from a Client.

**[MQTT-3.2.0-1]** The first packet sent from the Server to the Client MUST be a CONNACK Packet.

If the Client does not receive a CONNACK Packet from the Server within a reasonable amount of time, the Client SHOULD close the Network Connection. A "reasonable" amount of time depends on the type of application and the communications infrastructure.

## 5.2.2 Fixed Header

### Figure 5-4: CONNACK Packet Fixed Header

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────┬───────────────┐
byte 1    │  0   0   1   0│  0   0   0   0│  = 0x20
          │  Packet Type  │   Reserved    │
          └───────────────┴───────────────┘
byte 2    │  0   0   0   0   0   0   1   0│  = 0x02
          │       Remaining Length        │
          └───────────────────────────────┘
```

**Remaining Length:** This has the value 2 for the CONNACK Packet.

## 5.2.3 Variable Header

The variable header contains two fields:

### Figure 5-5: CONNACK Packet Variable Header

```
Bit         7   6   5   4   3   2   1   0
          ┌───────────────────────────┬───┐
byte 1    │         Reserved          │SP │  Connect Acknowledge Flags
          └───────────────────────────┴───┘
byte 2    │     Connect Return Code       │
          └───────────────────────────────┘
```

### 5.2.3.1 Connect Acknowledge Flags

Byte 1 is the "Connect Acknowledge Flags". Bits 7-1 are reserved and MUST be set to 0.

Bit 0 (SP) is the Session Present Flag.

### 5.2.3.2 Session Present

**Position:** bit 0 of the Connect Acknowledge Flags

**[MQTT-3.2.2-1]** If the Server accepts a connection with CleanSession set to 1, the Server MUST set Session Present to 0 in the CONNACK packet in addition to setting a zero return code in the CONNACK packet.

**[MQTT-3.2.2-2]** If the Server accepts a connection with CleanSession set to 0 and the Server has stored Session state, it MUST set Session Present to 1 in the CONNACK packet.

**[MQTT-3.2.2-3]** If the Server accepts a connection with CleanSession set to 0 and the Server does not have stored Session state, it MUST set Session Present to 0 in the CONNACK packet. This is in addition to setting a zero return code.

The Session Present flag enables a Client to establish whether the Client and Server have a consistent view about whether there is already stored Session state.

**[MQTT-3.2.2-4]** If a server sends a CONNACK packet containing a non-zero return code it MUST set Session Present to 0.

### 5.2.3.3 Connect Return Code

Byte 2 in the Variable header.

### Table 5-3: Connect Return Code Values

| Value | Return Code Response | Description |
|-------|---------------------|-------------|
| 0 | 0x00 Connection Accepted | Connection accepted |
| 1 | 0x01 Connection Refused, unacceptable protocol version | The Server does not support the level of the MQTT protocol requested by the Client |
| 2 | 0x02 Connection Refused, identifier rejected | The Client identifier is a valid UTF-8 string but is not allowed by the Server |
| 3 | 0x03 Connection Refused, Server unavailable | The Network Connection has been made but the MQTT service is unavailable |
| 4 | 0x04 Connection Refused, bad user name or password | The data in the user name or password is malformed |
| 5 | 0x05 Connection Refused, not authorized | The Client is not authorized to connect |
| 6-255 | Reserved | Reserved for future use |

**[MQTT-3.2.2-5]** If a server sends a CONNACK packet containing a non-zero return code it MUST then close the Network Connection.

**[MQTT-3.2.2-6]** If none of the return codes listed above are deemed applicable, then the Server MUST close the Network Connection without sending a CONNACK.

## 5.2.4 Payload

The CONNACK Packet has no payload.

## 5.2.5 Non-Normative Examples

### Example 1: Successful Connection (Clean Session)

```
Client → Server: CONNECT (CleanSession=1, ClientId="client1")
Server → Client: CONNACK (SP=0, Return Code=0x00)
```

### Example 2: Successful Connection (Existing Session)

```
Client → Server: CONNECT (CleanSession=0, ClientId="client1")
Server → Client: CONNACK (SP=1, Return Code=0x00)
```

Session Present = 1 indicates the server has stored session state.

### Example 3: Connection Refused (Bad Protocol Version)

```
Client → Server: CONNECT (Protocol Level=3)
Server → Client: CONNACK (SP=0, Return Code=0x01)
Server: closes connection
```

### Example 4: Connection Refused (Identifier Rejected)

```
Client → Server: CONNECT (CleanSession=0, ClientId="")
Server → Client: CONNACK (SP=0, Return Code=0x02)
Server: closes connection
```

### Figure 5-6: CONNACK Packet Wire Format

```
Successful connection with stored session:

Byte 1: 0x20  (CONNACK packet type)
Byte 2: 0x02  (Remaining Length = 2)
Byte 3: 0x01  (Session Present = 1)
Byte 4: 0x00  (Return Code = Connection Accepted)
```
