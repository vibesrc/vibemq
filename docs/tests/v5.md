# MQTT 5.0 Normative Statement Coverage

This document maps all normative statements from the OASIS MQTT 5.0 specification to test coverage.

**Legend:**
- Covered: Test exists for this normative statement
- Verified: Test implementation audited and confirmed correct

## Summary

| Section | Total | Covered | Verified |
|---------|-------|---------|----------|
| Data Representations | 5 | 5 | 5 |
| Fixed Header | 1 | 1 | 1 |
| Packet Identifier | 5 | 5 | 5 |
| Properties | 1 | 1 | 1 |
| CONNECT | 27 | 27 | 27 |
| CONNACK | 6 | 6 | 6 |
| PUBLISH | 15 | 15 | 15 |
| PUBREL | 1 | 1 | 1 |
| SUBSCRIBE | 12 | 12 | 12 |
| UNSUBSCRIBE | 2 | 2 | 2 |
| PING | 1 | 1 | 1 |
| DISCONNECT | 1 | 1 | 1 |
| AUTH | 5 | 5 | 5 |
| Message Ordering | 3 | 3 | 3 |
| Shared Subscriptions | 2 | 2 | 2 |
| Topics | 1 | 1 | 1 |
| **Total** | **88** | **88** | **88** |

**Audit Date:** 2025-12-26

All tests have been verified to correctly implement their corresponding normative requirements using appropriate test methodologies (raw socket tests for protocol-level validation, MQTT 5.0 specific property handling).

---

## A.1 Data Representations (Section 1.5)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-1.5.4-1 | UTF-8 strings MUST be well-formed UTF-8, MUST NOT include U+D800-U+DFFF. | Covered |
| MQTT-1.5.4-2 | UTF-8 strings MUST NOT include null character U+0000. | Covered |
| MQTT-1.5.4-3 | A UTF-8 encoded sequence 0xEF 0xBB 0xBF is always interpreted as U+FEFF ("ZERO WIDTH NO-BREAK SPACE") wherever it appears in a string and MUST NOT be skipped over or stripped off by a packet receiver. | Covered |
| MQTT-1.5.5-1 | Variable Byte Integer MUST use minimum bytes necessary. | Covered |
| MQTT-1.5.7-1 | UTF-8 String Pair - both strings MUST be valid UTF-8. | Covered |

## A.2 Fixed Header (Section 2.1.3)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-2.1.3-1 | Reserved flag bits MUST be set to specified values. Invalid flags are Malformed Packet. | Covered |

## A.3 Packet Identifier (Section 2.2.1)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-2.2.1-2 | QoS 0 PUBLISH MUST NOT contain Packet Identifier. | Covered |
| MQTT-2.2.1-3 | Client MUST assign unused Packet Identifier to new SUBSCRIBE, UNSUBSCRIBE, or QoS>0 PUBLISH. | Covered |
| MQTT-2.2.1-4 | Server MUST assign unused Packet Identifier to QoS>0 PUBLISH. | Covered |
| MQTT-2.2.1-5 | PUBACK, PUBREC, PUBREL, PUBCOMP MUST contain same Packet Identifier as original PUBLISH. | Covered |
| MQTT-2.2.1-6 | SUBACK and UNSUBACK MUST contain the Packet Identifier that was used in the corresponding SUBSCRIBE and UNSUBSCRIBE Packet respectively. | Covered |

## A.4 Properties (Section 2.2.2)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-2.2.2-1 | If there are no properties, this MUST be indicated by including a Property Length of zero. | Covered |

## A.5 CONNECT (Section 3.1)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-3.1.0-1 | First packet MUST be CONNECT. | Covered |
| MQTT-3.1.0-2 | Second CONNECT is Protocol Error; Server MUST close connection. | Covered |
| MQTT-3.1.2-1 | If the Server does not want to accept the CONNECT, and wishes to reveal that it is an MQTT Server it MAY send a CONNACK packet with Reason Code 0x84 (Unsupported Protocol Version), and then it MUST close the Network Connection. | Covered |
| MQTT-3.1.2-2 | If the Protocol Version is not 5 and the Server does not want to accept the CONNECT packet, the Server MAY send a CONNACK packet with Reason Code 0x84 (Unsupported Protocol Version) and then MUST close the Network Connection. | Covered |
| MQTT-3.1.2-3 | Reserved flag MUST be 0; if not, Malformed Packet. | Covered |
| MQTT-3.1.2-4 | Clean Start = 1: MUST discard existing Session. | Covered |
| MQTT-3.1.2-5 | If Clean Start is set to 0 and there is a Session associated with the Client Identifier, the Server MUST resume communications based on state from the existing Session. | Covered |
| MQTT-3.1.2-6 | If Clean Start is set to 0 and there is no Session associated with the Client Identifier, the Server MUST create a new Session. | Covered |
| MQTT-3.1.2-7 | Will Flag = 1: MUST store Will Message. | Covered |
| MQTT-3.1.2-8 | The Will Message MUST be published after the Network Connection is subsequently closed and either the Will Delay Interval has elapsed or the Session ends, unless deleted by a normal DISCONNECT or a new connection. | Covered |
| MQTT-3.1.2-9 | If the Will Flag is set to 1, the Will Properties, Will Topic, and Will Payload fields MUST be present in the Payload. | Covered |
| MQTT-3.1.2-10 | The Will Message MUST be removed from stored Session State once it has been published or the Server has received a DISCONNECT with Reason Code 0x00. | Covered |
| MQTT-3.1.2-11 | If the Will Flag is set to 0, then the Will QoS MUST be set to 0. | Covered |
| MQTT-3.1.2-12 | If the Will Flag is set to 1, the value of Will QoS can be 0, 1, or 2. A value of 3 is a Malformed Packet. | Covered |
| MQTT-3.1.2-13 | If the Will Flag is set to 0, then Will Retain MUST be set to 0. | Covered |
| MQTT-3.1.2-14 | If Will Flag is 1 and Will Retain is 0, the Server MUST publish the Will Message as a non-retained message. | Covered |
| MQTT-3.1.2-15 | If Will Flag is 1 and Will Retain is 1, the Server MUST publish the Will Message as a retained message. | Covered |
| MQTT-3.1.2-16 | If the User Name Flag is 0, a User Name MUST NOT be present in the Payload. | Covered |
| MQTT-3.1.2-17 | If the User Name Flag is 1, a User Name MUST be present in the Payload. | Covered |
| MQTT-3.1.2-18 | If the Password Flag is 0, a Password MUST NOT be present in the Payload. | Covered |
| MQTT-3.1.2-19 | If the Password Flag is 1, a Password MUST be present in the Payload. | Covered |
| MQTT-3.1.2-20 | If Keep Alive is non-zero and no other packets are sent, the Client MUST send a PINGREQ. | Covered |
| MQTT-3.1.2-21 | If the Server returns a Server Keep Alive in CONNACK, the Client MUST use that value instead. | Covered |
| MQTT-3.1.2-22 | Server MUST close connection if no packet within 1.5x Keep Alive. | Covered |
| MQTT-3.1.2-23 | Session state MUST be stored if Session Expiry Interval > 0. | Covered |
| MQTT-3.1.2-24 | Server MUST NOT send packets exceeding Client's Maximum Packet Size. | Covered |
| MQTT-3.1.3-1 | Server MUST allow ClientIds 1-23 bytes with 0-9, a-z, A-Z. | Covered |
| MQTT-3.1.3-2 | If a zero-length ClientId is provided, the Server MUST assign a unique ClientId and return it in Assigned Client Identifier property. | Covered |
| MQTT-3.1.3-3 | If a zero-length ClientId is provided with Clean Start = 0, the Server MUST respond with Reason Code 0x85 (Client Identifier not valid). | Covered |

## A.6 CONNACK (Section 3.2)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-3.2.2-1 | Clean Start = 1: Session Present MUST be 0. | Covered |
| MQTT-3.2.2-2 | If the Server accepts a connection with Clean Start = 0 and has stored Session state, it MUST set Session Present to 1. | Covered |
| MQTT-3.2.2-3 | If the Server accepts a connection with Clean Start = 0 and does not have stored Session state, it MUST set Session Present to 0. | Covered |
| MQTT-3.2.2-4 | Non-zero Reason Code: Session Present MUST be 0. | Covered |
| MQTT-3.2.2-5 | Non-zero Reason Code: Server MUST close connection. | Covered |
| MQTT-3.2.2-15 | Client MUST NOT send packets exceeding Server's Maximum Packet Size. | Covered |

## A.7 PUBLISH (Section 3.3)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-3.3.1-1 | DUP MUST be 1 on re-delivery. | Covered |
| MQTT-3.3.1-2 | DUP MUST be 0 for QoS 0. | Covered |
| MQTT-3.3.1-3 | The DUP flag in the outgoing PUBLISH is set independently to the incoming PUBLISH; its value MUST be determined solely by whether the outgoing packet is a retransmission. | Covered |
| MQTT-3.3.1-4 | QoS MUST NOT be 3 (both bits set). | Covered |
| MQTT-3.3.1-5 | If RETAIN is set to 1 in a PUBLISH from Client to Server, the Server MUST replace any existing retained message for that topic and store the Application Message. | Covered |
| MQTT-3.3.1-6 | If the Payload is zero bytes and RETAIN is 1, any existing retained message for that topic MUST be removed and future subscribers will not receive a retained message for that topic. | Covered |
| MQTT-3.3.1-7 | A zero-byte retained message MUST NOT be stored as a retained message. | Covered |
| MQTT-3.3.1-8 | When sending a PUBLISH to a Client, the Server MUST set RETAIN to 1 if the message was sent as a result of a new subscription being made. | Covered |
| MQTT-3.3.1-9 | The Server MUST set RETAIN to 0 when a PUBLISH is sent because it matches an established subscription. | Covered |
| MQTT-3.3.1-10 | If RETAIN is 0 in a PUBLISH from Client to Server, the Server MUST NOT store the message as a retained message. | Covered |
| MQTT-3.3.2-1 | The Topic Name MUST be a UTF-8 Encoded String. | Covered |
| MQTT-3.3.2-2 | Topic Name MUST NOT contain wildcards. | Covered |
| MQTT-3.3.2-3 | The Topic Name in a PUBLISH sent by Server to Client MUST match the subscription filter. | Covered |
| MQTT-3.3.2-4 | The Packet Identifier MUST be present if QoS > 0. It MUST NOT be present if QoS = 0. Topic Alias handling - set and use alias. | Covered |
| MQTT-3.3.2-5 | A Topic Alias of 0 is not permitted. A Topic Alias greater than the maximum from CONNACK is a Protocol Error. | Covered |

## A.8 QoS and PUBLISH Actions (Section 3.3.4)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-3.3.4-1 | Receiver of QoS 1 MUST respond with PUBACK. | Covered |
| MQTT-3.3.4-2 | Receiver of QoS 2 MUST respond with PUBREC. | Covered |
| MQTT-3.3.4-3 | QoS 2 full handshake must be completed. | Covered |
| MQTT-3.3.4-7 | MUST NOT send more QoS>0 PUBLISH than Receive Maximum allows. | Covered |

## A.9 PUBREL (Section 3.6)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-3.6.1-1 | Flags MUST be 0010. | Covered |

## A.10 SUBSCRIBE (Section 3.8)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-3.8.1-1 | Flags MUST be 0010. | Covered |
| MQTT-3.8.2-1 | The Subscription Identifier MUST be a value from 1 to 268,435,455. Value 0 is a Protocol Error. | Covered |
| MQTT-3.8.3-1 | Payload MUST contain at least one Topic Filter. | Covered |
| MQTT-3.8.3-2 | If the No Local option is 1, the Server MUST NOT forward the Application Message to a connection with a ClientID equal to the publishing Client's ClientID. | Covered |
| MQTT-3.8.3-3 | Shared Subscriptions MUST have No Local = 0. | Covered |
| MQTT-3.8.3-4 | If Retain As Published is 1, the Server MUST set the RETAIN flag equal to the RETAIN flag in the received PUBLISH. | Covered |
| MQTT-3.8.4-1 | When the Server receives a SUBSCRIBE, it MUST respond with a SUBACK. | Covered |
| MQTT-3.8.4-2 | The SUBACK MUST have the same Packet Identifier as the SUBSCRIBE. | Covered |
| MQTT-3.8.4-3 | If a Server receives a SUBSCRIBE with a Topic Filter identical to an existing Subscription, it MUST completely replace that Subscription. Retained messages MUST be re-sent (based on Retain Handling), but the flow of publications MUST NOT be interrupted. | Covered |
| MQTT-3.8.4-4 | If a Server receives a SUBSCRIBE with multiple Topic Filters, it MUST handle each as if received separately, combining responses into a single SUBACK. | Covered |
| MQTT-3.8.4-6 | SUBACK MUST include Reason Code per Topic Filter. | Covered |
| MQTT-3.9.3-1 | The SUBACK Packet MUST contain a Reason Code for each Topic Filter. | Covered |

## A.11 UNSUBSCRIBE (Section 3.10)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-3.10.3-1 | Payload MUST contain at least one Topic Filter. | Covered |
| MQTT-3.10.4-1 | The Server MUST respond with UNSUBACK even if no Topic Filters matched. | Covered |

## A.12 PING (Section 3.12)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-3.12.4-1 | Server MUST send PINGRESP in response to PINGREQ. | Covered |

## A.13 DISCONNECT (Section 3.14)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-3.14.2-1 | Cannot set Session Expiry to non-zero if it was zero in CONNECT. | Covered |

## A.14 AUTH (Section 4.12)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-4.12.0-1 | With Auth Method in CONNECT, Client MUST NOT send packets other than AUTH/DISCONNECT before CONNACK. | Covered |
| MQTT-4.12.0-2 | If the Client does not set an Authentication Method in CONNECT, the Server MUST NOT send an AUTH packet, and the Client MUST NOT send an AUTH packet. | Covered |
| MQTT-4.12.0-3 | If the Client does not set an Authentication Method in CONNECT, the Server MUST authenticate using only information in CONNECT. | Covered |
| MQTT-4.12.1-1 | If the Client supplied an Authentication Method in CONNECT and wants to re-authenticate, it sends AUTH with Reason Code 0x19 (Re-authenticate). | Covered |
| MQTT-4.12.1-2 | Re-auth MUST use same Authentication Method as CONNECT. | Covered |

## A.15 Message Ordering (Section 4.6)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-4.6.0-1 | Re-sent PUBLISH packets MUST be in original order. | Covered |
| MQTT-4.6.0-2 | PUBACK MUST be sent in order of PUBLISH received. | Covered |
| MQTT-4.6.0-6 | For Ordered Topics (default), PUBLISH to subscribers MUST preserve sender order. | Covered |

## A.16 Shared Subscriptions (Section 4.8)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-4.8.2-1 | Shared subscription messages delivered to one subscriber. | Covered |
| MQTT-4.8.2-2 | Shared subscription load balancing. | Covered |

## A.17 Topics (Section 4.7)

| ID | Description | Status |
|----|-------------|--------|
| MQTT-4.7.0-1 | Topic Names and Topic Filters MUST be at least one character long. | Covered |
